{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Fish.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import {FishState,FishType} from './FishType';\r\nimport Game from \"./Game\";\r\nimport Bullet from \"./Bullet\";\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Fish extends cc.Component {\r\n    //属性声明类型，为了在编辑器面板显示类型\r\n @property(cc.Animation)\r\n anim:cc.Animation=null;//显示声明类型，才能有代码提示\r\n\r\n @property(cc.AudioClip)\r\n private fishah:cc.AudioClip=null;\r\n\r\n hp:number=10;//血量，默认是10\r\n gold:number=10;//该鱼会掉落的金币\r\n \r\n fishState:FishState=FishState.alive;//鱼的生命状态，默认都是活的\r\n lastPosition:cc.Vec2;//保存上一次坐标，用于更新角度\r\n fishType:FishType;\r\n \r\n game:Game;//暂存game实例\r\n\r\n//以下为7种贝塞尔曲线配置\r\nbezier1:cc.Vec2[]=[cc.p(50,-100),cc.p(300,-400),cc.p(1800,-650)];\r\nbezier2: cc.Vec2[] = [cc.p(100, -200), cc.p(400, -300), cc.p(1800, -600)];\r\nbezier3: cc.Vec2[] = [cc.p(150, -300), cc.p(600, -400), cc.p(1800, -500)];\r\nbezier4: cc.Vec2[] = [cc.p(50, 50), cc.p(400, 100), cc.p(1800, 200)];\r\nbezier5: cc.Vec2[] = [cc.p(80, 200), cc.p(300, 500), cc.p(1800, 650)];\r\nbezier6: cc.Vec2[] = [cc.p(100, 100), cc.p(350, 400), cc.p(1800, 500)];\r\nbezier7: cc.Vec2[] = [cc.p(100, 2), cc.p(350, -2), cc.p(1800, 0)];\r\nbezierArray=new Array();\r\n\r\ninit(game:Game){\r\n    this.bezierArray.push(this.bezier1);\r\n    this.bezierArray.push(this.bezier2);\r\n    this.bezierArray.push(this.bezier3);\r\n    this.bezierArray.push(this.bezier4);\r\n    this.bezierArray.push(this.bezier5);\r\n    this.bezierArray.push(this.bezier6);\r\n    this.bezierArray.push(this.bezier6);\r\n    this.game=game;\r\n    this.enabled=true;\r\n    this.spawnFish(game);\r\n}\r\n//生成随机类型的鱼\r\nspawnFish(game:Game){\r\n    let fishStr=game.fishTypes.length;\r\n    let randomFish=Math.floor(cc.random0To1()*fishStr);//cc.random0To1():返回一个0到1之间的随机数\r\n    this.fishType=game.fishTypes[randomFish];\r\n    let pos=cc.p(-cc.random0To1()*100-200,cc.randomMinus1To1()*300+350);//cc.randomMinus1To1():返回一个-1到1之间的随机数\r\n    this.node.position=cc.find(\"Canvas\").convertToNodeSpaceAR(pos);\r\n    let index=Math.floor(cc.random0To1()*this.bezierArray.length);\r\n    let bezier=this.bezierArray[index];\r\n    let firstBzr=bezier[0];//贝塞尔曲线第一个控制点用来计算初始角度\r\n    let k=Math.atan((firstBzr.y)/(firstBzr.x));\r\n    this.node.rotation=-k*180/3.14;\r\n    this.node.getComponent(cc.Sprite).spriteFrame=this.game.spAtlas.getSpriteFrame(this.fishType.name+\"_run_0\");\r\n    this.hp=this.fishType.hp;//取出鱼的血量\r\n    this.gold=this.fishType.gold;//掉落的金币\r\n    this.fishState=FishState.alive;\r\n    this.anim.play(this.fishType.name+'_run');\r\n    this.node.parent=cc.find(\"Canvas\");\r\n    this.lastPosition=this.node.getPosition();\r\n    this.changeCollier();//重新设置碰撞区域\r\n    this.swimFish(bezier);//让鱼游动起来\r\n}\r\nchangeCollier(){\r\n    let collider=this.node.getComponent(cc.BoxCollider);\r\n    collider.size=this.node.getContentSize();\r\n}\r\n//鱼游泳，贝塞尔曲线实现\r\nswimFish(path:any){\r\n    let windowSize=cc.director.getWinSize();\r\n    let speed=cc.random0To1()*10+10;\r\n    let bezierby=cc.bezierBy(speed,path);\r\n    this.node.runAction(bezierby);  \r\n}\r\nupdate(){\r\n    this.updateDegree();\r\n}\r\nupdateDegree(){\r\n    let currentPos=this.node.getPosition();\r\n    //如果位移不超过1则不改变角度\r\n    if(cc.pDistance(this.lastPosition,currentPos)<1){\r\n        return;\r\n    }\r\n    //计算角度\r\n    let degree;\r\n    if(currentPos.x-this.lastPosition.x==0){\r\n        //垂直\r\n        if(currentPos.y-this.lastPosition.y>0){\r\n            degree=-90;\r\n        }else{\r\n            degree=90;\r\n        }\r\n    }else{\r\n        degree=-Math.atan((currentPos.y-this.lastPosition.y)/(currentPos.x-this.lastPosition.x))*180/3.14;\r\n    }\r\n    this.node.rotation=degree;\r\n    this.lastPosition=currentPos;\r\n    this.beAttack();\r\n}\r\nbeAttack(){\r\n    if (this.isDie()) {\r\n        // 停止贝塞尔曲线动作\r\n        this.node.stopAllActions();\r\n        //播放死亡动画\r\n        let animState = this.anim.play(this.fishType.name + '_dead');\r\n        // 被打死的动画播放完成之后回调\r\n        animState.on('stop', this.dieCallback, this);\r\n        // 播放金币动画\r\n        // 转为世界坐标\r\n        let fp = this.node.parent.convertToWorldSpaceAR(this.node.position);//????????????????????????????????????????\r\n        this.game.gainCoins(fp, this.gold);\r\n    } else {\r\n        // 跑出屏幕的鱼自动回收\r\n        this.despawnFish();\r\n    }\r\n}\r\n//碰撞检测，鱼被打死的逻辑\r\nisDie():boolean{\r\n    if(this.fishState==FishState.dead){\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n//鱼被打死后的处理\r\ndieCallback(){\r\n    cc.audioEngine.play(this.fishah as any,false,1);\r\n    this.node.stopAllActions();//停止所有动作\r\n    this.game.despawnFish(this.node);\r\n}\r\ndespawnFish(){\r\n    if(this.node.x>900\r\n        || this.node.x<-1000\r\n        || this.node.y>600\r\n        || this.node.y<-900\r\n    ){\r\n        //this.node.removeFromParent();//可以不移除，停止所有动作也可完成\r\n        this.node.stopAllActions();\r\n        this.game.despawnFish(this.node);\r\n    } \r\n}\r\n//碰撞检测\r\nonCollisionEnter(other,self){\r\n    let bullet=<Bullet>other.node.getComponent(Bullet);\r\n    this.hp-=bullet.getAttackValue();\r\n    if(this.hp<=0){\r\n        this.fishState=FishState.dead;\r\n       // console.log(\"死死死\");\r\n    }\r\n}\r\n}\r\n"]}