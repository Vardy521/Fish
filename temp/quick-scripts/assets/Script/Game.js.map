{"version":3,"sources":["Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import {FishState,FishType} from \"./FishType\";\r\nimport Fish from \"./Fish\";\r\nimport Bullet from \"./Bullet\";\r\nimport Net from \"./Net\";\r\nimport CoinsControls from \"./CoinsControls\";\r\nimport Weapon from \"./Weapon\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n    @property(cc.Prefab)\r\n    fishPrefab:cc.Prefab=null;\r\n\r\n    @property(cc.Node)\r\n    weaponNode:cc.Node=null;\r\n\r\n    @property(cc.Prefab)\r\n    bulletPrefab:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    netPrefab:cc.Prefab=null;\r\n\r\n    @property(cc.Node)\r\n    coinsControls:cc.Node=null;\r\n\r\n    @property(cc.SpriteAtlas)\r\n    spAtlas:cc.SpriteAtlas=null;\r\n\r\n    @property(cc.Node)\r\n    gameoverNode:cc.Node=null;\r\n\r\n    @property(cc.AudioClip)\r\n    private bgm:cc.AudioClip=null;\r\n    \r\n    @property(cc.AudioClip)\r\n    private bgmWater:cc.AudioClip=null;\r\n\r\n    oneFish:cc.Node;\r\n    oneBullet:cc.Node;\r\n    oneNet:cc.Node;\r\n    fishPool:cc.NodePool;\r\n    fishTypes:FishType[];\r\n    bulletPool:cc.NodePool;\r\n    netPool:cc.NodePool;\r\n    \r\n    onLoad(){\r\n        cc.director.getCollisionManager().enabled=true;//开启碰撞系统\r\n        cc.audioEngine.play(this.bgm as any,true,1);//播放背景音乐\r\n        cc.audioEngine.play(this.bgmWater as any,true,1);\r\n        this.bulletPool=new cc.NodePool(Bullet);\r\n        this.fishPool=new cc.NodePool(Fish);\r\n        this.netPool=new cc.NodePool(Net);\r\n        let fishCount=10;\r\n        for(let i=0;i<fishCount;i++){\r\n            let fishPre=cc.instantiate(this.fishPrefab);\r\n            this.fishPool.put(fishPre);\r\n        }\r\n        cc.find(\"Canvas/bg\").setLocalZOrder(-1);//setLocalZOrder:设置z轴层级\r\n        cc.find(\"Canvas/btmBar\").setLocalZOrder(1);\r\n        this.gameoverNode.setLocalZOrder(2);\r\n        this.gameoverNode.active=false;\r\n        this.coinsControls.getComponent(CoinsControls).init();\r\n        this.weaponNode.getComponent(Weapon).init();\r\n        let self=this;\r\n        //在屏幕上显示FPS数，开发阶段建议开启这个设置，可以通过这个对自己游戏性能有个大体了解，等游戏正式发布可关闭这个设置\r\n        cc.director.setDisplayStats(true);\r\n        //动态加载json配置文件\r\n        cc.loader.loadRes(\"FishConfig\",function(err,data){\r\n            if(err){\r\n                cc.error(err.message || err);\r\n                return;\r\n            }\r\n            //加载之后转类型\r\n            self.fishTypes=<FishType[]>data;\r\n            self.schedule(self.createFish,2);//每隔2秒执行一次self.createFish方法\r\n        });\r\n        //添加触摸事件\r\n        this.node.on(cc.Node.EventType.TOUCH_START,function(event:cc.Event.EventTouch){\r\n            //需要将触点坐标转换成局部坐标，跟炮台一致（为什么？这样才能保证子弹从炮台以上位置射出，否则就会从屏幕底部射出）\r\n            let touchPos=self.weaponNode.parent.convertTouchToNodeSpaceAR(event.touch);\r\n            let weaponPos=self.weaponNode.getPosition();\r\n            if(touchPos.y<weaponPos.y) return;\r\n            let radian=Math.atan((touchPos.x-weaponPos.x)/(touchPos.y-weaponPos.y));\r\n            let degree=radian*180/3.14;\r\n            self.weaponNode.rotation=degree;\r\n            let BulletLevel=self.weaponNode.getComponent(Weapon).curLevel;\r\n            self.shot(BulletLevel);\r\n        },this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,function(event){\r\n            return;\r\n        },this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,function(event){\r\n            return;\r\n        },this);\r\n    }\r\n    //开炮\r\n    shot(lev:number){\r\n        if(this.bulletPool.size()>0){\r\n            this.oneBullet=this.bulletPool.get(this);\r\n        }else{\r\n            this.oneBullet=cc.instantiate(this.bulletPrefab);\r\n        }\r\n        //是否剩余金币\r\n        let left=this.coinsControls.getComponent(CoinsControls).reduceCoin(lev);\r\n        if(left){\r\n            this.oneBullet.getComponent(Bullet).shot(this,lev);\r\n        }else{\r\n            if(this.coinsControls.getComponent(CoinsControls).currnetValue==0){\r\n                this.gameOver();\r\n                cc.audioEngine.stopAll();\r\n            }\r\n        }\r\n    }\r\n    createFish(){\r\n        let fishcount=3;\r\n        for(let i=0;i<fishcount;i++){\r\n            let cfish:cc.Node=null;\r\n            if(this.fishPool.size()>0){\r\n                cfish=this.fishPool.get(this);\r\n            }else{\r\n                cfish=cc.instantiate(this.fishPrefab);\r\n            }\r\n            cfish.getComponent(Fish).init(this);\r\n        }\r\n    }\r\n    castNet(pos:cc.Vec2){\r\n        if(this.netPool.size()>0){\r\n            this.oneNet=this.netPool.get(this);\r\n        }else{\r\n            this.oneNet=cc.instantiate(this.netPrefab);\r\n        }\r\n        let bulletLever=this.weaponNode.getComponent(Weapon).curLevel;\r\n        this.oneNet.getComponent(Net).init(pos,this,bulletLever);\r\n    }\r\n    despawnFish(fish:cc.Node){\r\n        this.fishPool.put(fish);\r\n    }\r\n    despawnBullet(bullet:cc.Node){\r\n        this.bulletPool.put(bullet);\r\n    }\r\n    despawnNet(net:cc.Node){\r\n        this.netPool.put(net);\r\n    }\r\n    gainCoins(coinPos:cc.Vec2,value:number){\r\n        this.coinsControls.getComponent(CoinsControls).gainCoins(coinPos,value);\r\n    }\r\n    gameOver(){\r\n        this.gameoverNode.active=true;\r\n        this.unscheduleAllCallbacks();//停止所有计时器\r\n    }\r\n    gameReStart(){\r\n        cc.director.loadScene(\"fishmain\");\r\n        cc.audioEngine.play(this.bgm as any,true,1);//播放背景音乐\r\n        cc.audioEngine.play(this.bgmWater as any,true,1);\r\n    }\r\n}\r\n"]}